<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sub Goal Widget</title>
    <style>
        body {
            background: transparent;
            color: #fff;
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        .goal-container {
            background: rgba(30,30,30,0.85);
            border-radius: 18px;
            padding: 32px 40px;
            box-shadow: 0 4px 32px #000a;
            min-width: 320px;
            text-align: center;
            position: relative;
        }
        .goal-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 12px;
        }
        .goal-desc {
            font-size: 1.2rem;
            margin-bottom: 18px;
        }
        .goal-progress {
            width: 100%;
            background: #222;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
            height: 24px;
            box-shadow: 0 2px 8px #0004 inset;
        }
        .goal-bar {
            height: 100%;
            background: linear-gradient(90deg, #9146ff, #00ff88);
            transition: width 0.5s cubic-bezier(.4,2,.6,1);
        }
        .goal-count {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        .goal-validated {
            color: #00ff88;
            font-weight: bold;
            font-size: 1.3rem;
            margin-top: 10px;
            animation: pop 0.7s cubic-bezier(.4,2,.6,1);
        }
        @keyframes pop {
            0% { transform: scale(0.7); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        .confetti {
            pointer-events: none;
            position: absolute;
            left: 0; top: 0; width: 100%; height: 100%;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="goal-container">
        <div class="goal-title" id="goalTitle"></div>
        <div class="goal-desc" id="goalDesc"></div>
        <div class="goal-progress"><div class="goal-bar" id="goalBar"></div></div>
        <div class="goal-count" id="goalCount"></div>
        <div class="goal-validated" id="goalValidated" style="display:none;">Goal validated!</div>
        <canvas class="confetti" id="confettiCanvas" style="display:none;"></canvas>
    </div>
    <script>
    // --- CONFIGURE YOUR GOALS HERE ---
    const subGoals = [
        { count: 100, desc: 'Start my own game' },
        { count: 200, desc: 'Start my own company' },
        // Add more goals as needed
    ];

    // --- STREAMER SETTINGS ---
    const streamerChannel = 'sc0rpio74890';
    const jwtToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjaXRhZGVsIiwiZXhwIjoxNzY4OTMxMTU2LCJqdGkiOiI2NWU2ZDBhZS1hYWU2LTRkZGItOWQ5Zi1iNWM0NTMyZWI4NmMiLCJjaGFubmVsIjoiNjg4MjZiNWQzYjAzY2QzZWMxMDljZmQwIiwicm9sZSI6Im93bmVyIiwiYXV0aFRva2VuIjoiaE95dTBSdzRidjBNWm9RZjJuT1pRdWtTX21KUkxJd3VBRjFUeC00X2t3a1ExWG9wIiwidXNlciI6IjY4ODI2YjVkM2IwM2NkM2VjMTA5Y2ZjZiIsInVzZXJfaWQiOiIyNjgwZTkwYi01M2ZiLTQzYTQtYjU2My05YjE5NTU5NDIwNWQiLCJ1c2VyX3JvbGUiOiJjcmVhdG9yIiwicHJvdmlkZXIiOiJ0d2l0Y2giLCJwcm92aWRlcl9pZCI6IjY3MDk0NzQ4MiIsImNoYW5uZWxfaWQiOiI1OTY2NjhhZS1kZjU0LTRkMDUtYTAzNi1kZWE3ZWQ2N2NjYWMiLCJjcmVhdG9yX2lkIjoiMjU1MDJkYzQtZWU0YS00YWU4LWI0NjAtZDY4NWZiOTU2YTVkIn0.R5-4CZdUxOhwTP8fG8Ydj25tdCfTk_7prd70Z-ddfb0';

    // --- STATE ---
    let currentGoalIndex = 0;
    let currentSubCount = 0;
    let maxGoalReached = false;

    // --- UI ELEMENTS ---
    const goalTitle = document.getElementById('goalTitle');
    const goalDesc = document.getElementById('goalDesc');
    const goalBar = document.getElementById('goalBar');
    const goalCount = document.getElementById('goalCount');
    const goalValidated = document.getElementById('goalValidated');
    const confettiCanvas = document.getElementById('confettiCanvas');

    // --- CONFETTI ANIMATION ---
    function launchConfetti() {
        confettiCanvas.style.display = 'block';
        const ctx = confettiCanvas.getContext('2d');
        confettiCanvas.width = confettiCanvas.offsetWidth;
        confettiCanvas.height = confettiCanvas.offsetHeight;
        const W = confettiCanvas.width, H = confettiCanvas.height;
        const pieces = Array.from({length: 80}, () => ({
            x: Math.random()*W, y: Math.random()*-H, r: 6+Math.random()*8, d: Math.random()*80,
            color: `hsl(${Math.random()*360},90%,60%)`, tilt: Math.random()*10, tiltAngle: 0
        }));
        let angle = 0;
        function draw() {
            ctx.clearRect(0,0,W,H);
            for (let p of pieces) {
                ctx.beginPath();
                ctx.ellipse(p.x, p.y, p.r, p.r/2, p.tilt, 0, 2*Math.PI);
                ctx.fillStyle = p.color;
                ctx.fill();
            }
            update();
        }
        function update() {
            angle += 0.01;
            for (let p of pieces) {
                p.y += (Math.cos(angle+p.d)+3+p.r/4)/2;
                p.x += Math.sin(angle);
                p.tilt += 0.05;
                if (p.y > H) { p.x = Math.random()*W; p.y = -10; }
            }
        }
        let frame = 0;
        function animate() {
            draw();
            frame++;
            if (frame < 120) requestAnimationFrame(animate);
            else confettiCanvas.style.display = 'none';
        }
        animate();
    }

    // --- RENDER FUNCTION ---
    function renderGoal() {
        if (currentGoalIndex >= subGoals.length) {
            // All goals completed
            goalTitle.textContent = 'All goals completed!';
            goalDesc.textContent = subGoals[subGoals.length-1].desc;
            goalBar.style.width = '100%';
            goalCount.textContent = `${currentSubCount} / ${subGoals[subGoals.length-1].count}`;
            goalValidated.style.display = 'block';
            goalValidated.textContent = 'Goal validated!';
            maxGoalReached = true;
            return;
        }
        const goal = subGoals[currentGoalIndex];
        goalTitle.textContent = `Sub Goal #${currentGoalIndex+1}`;
        goalDesc.textContent = goal.desc;
        let percent = Math.min(100, Math.round((currentSubCount/goal.count)*100));
        goalBar.style.width = percent + '%';
        goalCount.textContent = `${currentSubCount} / ${goal.count}`;
        if (currentSubCount >= goal.count) {
            goalValidated.style.display = 'block';
            goalValidated.textContent = 'Goal validated!';
        } else {
            goalValidated.style.display = 'none';
        }
    }


    // --- STREAMELEMENTS WEBSOCKET ---
    // Disabled: WebSocket not supported on public web (GitHub Pages, etc.)
    // function connectStreamElements() { /* ... */ }

    // --- POLL SUB COUNT FROM API (for sub loss) ---
    async function pollSubCount() {
        try {
            // Replace with your StreamElements channel ID if needed
            const channelId = streamerChannel;
            const resp = await fetch(`https://api.streamelements.com/kappa/v2/channels/${channelId}`);
            if (resp.ok) {
                const data = await resp.json();
                if (data && typeof data.subscriberCount === 'number') {
                    if (data.subscriberCount > currentSubCount) {
                        currentSubCount = data.subscriberCount;
                        checkAdvanceGoal();
                    } else if (data.subscriberCount < currentSubCount) {
                        // Only allow forward progress in goals
                        currentSubCount = data.subscriberCount;
                        renderGoal();
                    }
                }
            }
        } catch (e) {}
        setTimeout(pollSubCount, 60000); // poll every 60s
    }

    // --- INIT ---
    function init() {
        currentGoalIndex = 0;
        currentSubCount = 0;
        maxGoalReached = false;
        renderGoal();
        // connectStreamElements(); // Disabled: WebSocket not supported on public web
        pollSubCount();
    }
    window.onload = init;
    </script>
</body>
</html>
