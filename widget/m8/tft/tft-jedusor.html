<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFT Widget</title>
    <style>
        @font-face {
            font-family: 'Helvetica Neue';
            src: url('../../font/helvetica-neue-5/HelveticaNeueBlackItalic.otf') format('opentype');
            font-style: italic;
            font-weight: 900;
        }

        html, body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #00000000;
            color: white;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        .background-image {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            width: auto;
            height: 100%;
            display: block;
            max-width: none;
        }

        .text-overlay {
            position: absolute;
            top: 50%;
            left: 50px;
            transform: translateY(-50%) scaleY(1.2) scaleX(0.85);
            z-index: 2;
            font-family: 'Helvetica Neue', sans-serif;
            font-style: italic;
            font-weight: 900;
            color: black;
            font-size: 100px;
            white-space: nowrap;
        }

        .points-container {
            position: absolute;
            top: 50%;
            left: 50px;
            transform: translateY(-50%) scaleY(1.2) scaleX(0.85);
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 20px;
            padding-left: 550px;
        }

        .separator {
            height: 50px;
            width: 30px;
            display: inline-block;
        }

        .points-text {
            font-family: 'Helvetica Neue', sans-serif;
            font-style: italic;
            font-weight: 900;
            color: black;
            font-size: 60px;
        }

        .rankings {
            font-family: 'Helvetica Neue', sans-serif;
            font-weight: 900;
            color: black;
            font-size: 75px;
        }
    </style>
</head>
<body>
    <img src="image/background.png" alt="Background" class="background-image">
    <div class="text-overlay">JEDUSOR</div>
    <div class="points-container">
        <img src="image/separator.png" alt="separator" class="separator">
        <span class="points-text" id="points">43pts - </span>
        <span class="rankings" id="rankings">#3 #6 #2</span>
    </div>

    <script src="https://unpkg.com/tmi.js@1.8.5/dist/tmi.min.js"></script>
    <script>
        window.addEventListener('load', function() {
            const authorizedUsers = [
                'sc0rpio74890',
            ];

            const client = new tmi.Client({
                channels: ['sc0rpio74890']
            });

            client.connect().catch(console.error);

        // Listen for chat messages
        client.on('message', (channel, tags, message, self) => {
            if (self) return; // Ignore messages from the bot itself

            const username = tags.username.toLowerCase();
            const isMod = tags.mod;
            const isBroadcaster = tags.badges?.broadcaster === '1';

            // Check if user is authorized (broadcaster, mod, or in the authorized list)
            const isAuthorized = isBroadcaster || isMod || authorizedUsers.includes(username);

            if (!isAuthorized) return;

            // Check if message starts with !jedusor
            if (message.toLowerCase().startsWith('!jedusor ')) {
                const args = message.slice(9).trim(); // Remove "!jedusor " from the message

                // Parse the command: format is "100pts #4 #5 #9 #1"
                const parts = args.split(' ');

                if (parts.length < 2) return;

                const points = parts[0]; // e.g., "100pts"
                const rankings = parts.slice(1).join(' ');

                // Validate that first argument ends with "pts"
                if (!points.toLowerCase().endsWith('pts')) return;

                // Update the display
                document.getElementById('points').textContent = points + ' - ';
                document.getElementById('rankings').textContent = rankings;

                console.log(`Updated by ${username}: ${points} ${rankings}`);
            }
        });

            console.log('Twitch IRC connected to channel: sc0rpio74890');
            console.log('Waiting for !jedusor commands from authorized users...');
        });
    </script>
</body>
</html>
